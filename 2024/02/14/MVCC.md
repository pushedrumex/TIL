## MVCC

- Multi Version Concurrency Control
- 레코드 레벨의 트랜잭션을 지원하는 DBMS 가 제공하는 기능
- 하나의 레코드에 대해 여러 개의 버전을 동시에 관리하는 것
- MVCC 의 목적은 일관된 읽기
- InnoDB 스토리지 엔진은 언두 로그를 이용해 MVCC 를 구현
    1. 1번 사용자가 특정 데이터를 update (커밋은 아직 X)
    2. 버퍼 풀과 디스크에는 변경된 내용 즉시 반영
    3. 언두영역에 변경되기 이전의 내용을 보관
    4. 2번 사용자가 조회 시 트랜잭션 격리 수준에 따라 버퍼풀이나 언두 영역에서 데이터를 반환
    5. 커밋된다면 지금의 디스크 상태를 영구적인 데이터로 만듬
    6. 롤백된다면 언두 영역에 있는 백업된 데이터를 innoDB 버퍼풀과 디스크로 복구하고 언두영역의 내용 삭제
- 언두 로그에 쌓인 버전들을 사용하여 트랜잭션 격리수준에 맞는 데이터를 조회
- commit 을 하면 버퍼풀의 상태를 영구적인 상태로 만듬. 언두 영역을 필요로 하는 트랜잭션이 없을 때 삭제됨.
    - 버퍼풀: InnoDB가 액세스 할 때 테이블 및 인덱스 데이터를 캐시하는 메인 메모리 영역
- rollback을 하면 언두 영역에 있는 백업된 데이터를 Innodb 버퍼 풀로 다시 복구하고 언두 영역의 내용을 삭제
- 단점: 트랜잭션이 길 경우 언두 로그가 커짐 → 트랜잭션은 가능한 작게 유지 해야함
