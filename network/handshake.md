# HandShake

## 3-way-handshake
연결을 수립하기 위한 과정
1. 클라이언트 → `SYN:1` → 서버
    - 송신처와 수신처의 포트번호를 설정하여 클라이언트 소켓과 서버 소켓을 지정
    - 컨트롤 비트 SYN를 1로 설정하여 TCP헤더를 생성
    - 시퀀스 번호 초기값을 난수로 설정하여 함께 전송
    - IP로 건네주어 송신을 의뢰
    - 서버측의 IP가 패킷을 받고 TCP로 넘김
    - TCP 헤더를 조사하여 수신처 포트 번호에 해당하는 소켓을 찾음
    - 소켓에 정보를 기록
2. 서버 → `SYN:1`/`ACK:1` → 클라이언트
    - 송신처와 수신처의 포트 번호와 SYN비트를 1로 설정한 TCP헤더 생성
    - ACK도 1로 만듬(클라이언트에서 전송한 패킷을 정상적으로 받은 것을 알리기 위한 동작)
    - IP에 건네주어 반송 의뢰
    - 클라이언트의 TCP에서 TCP헤더를 조사하여 SYN가 1이면 접속 성공이므로 서버의 IP주소나 포트번호 등과 함께 소켓에 접속 완료를 나타내는 제어 정보를 기록
3. 클라이언트 → `ACK:1` → 서버
    - 서버에서 전송한 패킷이 도착했다는 것을 알리기 위해 ACK를 1로 만든 TCP헤더를 반송

→ 소켓은 데이터를 송수신 할 수 있는 상태

## 4-way-handshake
연결을 끊기 위한 과정
1. 서버 → `FIN:1` → 클라이언트
   - 서버측의 어플리케이션에서 Socket라이브러리의 close를 호출
   - 프로토콜 스택이 TCP헤더를 만들고 FIN비트를 1로 설정
   - IP에 의뢰하여 클라이언트에게 송신 요청
2. 클라이언트 → ACK번호 → 서버
   - 클라이언트측의 프로토콜 스택은 자신의 소켓에 서버측이 연결 끊기동작에 들어갔다는 것을 기록
   - FIN이 1인 패킷을 받은 사실을 알리기 위해 ACK번호를 서버측에 반송
   - 어플리케이션의 데이터 수신이 완료될 때까지 대기
3. 클라이언트 → `FIN:1` → 서버
   - 서버에서 보낸 데이터 수신이 완료 되면 클라이언트측의 어플리케이션도 close를 호출
   - FIN비트를 1로 설정한 TCP헤더를 만들고 IP에 송신 의뢰
4. 서버 → ACK번호 → 클라이언트
   - FIN이 1인 패킷을 받은 사실을 알리기 위해 ACK번호를 클라이언트측에 반송
   - 서버에서 ACK번호가 돌아오면 서버와의 대화 끝